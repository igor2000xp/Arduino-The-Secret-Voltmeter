# Arduino-The-Secret-Voltmeter
The Secret Voltmeter with a sleep to remove digital noise


Author this is Igor (Igor2000xp)
https://github.com/igor2000xp/Arduino-The-Secret-Voltmeter

This sketch is designed to use Arduino as a 4-channel voltmeter.
The level of comments that the author was guided by when writing them is amateurs who understand the basics of the Arduino language and know the basic concepts of inserts an assembler code for managing the Arduino registers.

The author plans to use this code to assemble an external temperature measuring device with a lithium battery and a solar battery. The thermometer is assembled on Arduino, uses a temperature sensor DS18B20 and OLED display 128x64. As a voltmeter, the same Arduino board is used. At the input was a voltage divider with two resistors of 3.3 kΩ per channel. Thus, the voltmeter measured the voltage from 0 to 10 V with an accuracy of about 0.01 V. The ADC of the Arduino boards is 10-bit and this accuracy corresponds to a resolution from 0 to 1023. It is in this range that the ADC produces integers when measuring the voltage at the input of the ADC .

 The author of the experiments used Arduino Pro mini 5V, 16 MHz. However, almost any Arduino can be used. It is necessary to check the correspondence of the datasheet to the value of the internal reference voltage and the correspondence of the ADMUX and ADCSRA ADC control register bits.

The author will be grateful for the constructive criticism of the code and its optimization.

According to the author, there are several reasons that can negatively affect the use of Arduino as a voltmeter.

1. Instability of the voltage supply Arduino. The Arduino board is equipped with an internal parametric voltage regulator (5V or 3.3V depending on the board modification). To obtain a stable voltage of + 5V, you need to apply 6 ... 12V to a RAW pin of Arduino Pro mini. Many people use 5V on the pin RAW. In this case, Arduino will also work, but the internal stabilizer Arduino give out about 4.5 ... 4.8 V and this voltage will not be quite stable. The internal stabilizer, in this case, operates in an abnormal mode.
In addition, the author between the source 6 ... 12 V before the pin RAW put a filter from a capacitor 100 ... 480 μF and a choke of 10 ... 200 μH, directly between the RAW input and ground put a ceramic capacitor 0.1 ... 1.0 μF .
Also between Vcc and ground, put a tantalum capacitor is 10 ... 100 μF. The voltmeter readings became much more stable.


2. Due to various reasons (mainly the temperature of the Arduino board), the voltage at the Vcc and AVcc inputs may change very slightly and this will affect the accuracy of the voltage measurement. For periodic adjustment of the measured internal reference voltage (supply voltage), the author used the code of the author SCOTT  (https://provideyourown.com/2012/secret-arduino-voltmeter-measure-battery-voltage/).

3. Finely the measurement accuracy can be affected by the digital noise generated by the Atmega328p processor itself. To reduce it, the processor has one of the sleep modes - ADC Noise Reduction Mode. The code for its use was discussed on the Internet and on Arduino forums (for example http://forum.arduino.cc/index.php/topic,38119.0.html#14). But the author did not find the full working code. Therefore, I wrote my own sketch and combined the method of correction of measurement of the internal reference voltage of ADC and ADC Noise Reduction Mode in one sketch.

As a result, it was possible to achieve the accuracy of measuring the voltage close to the maximum achievable.

As a result, it was possible to achieve the accuracy of measuring the voltage close to the maximum achievable.


